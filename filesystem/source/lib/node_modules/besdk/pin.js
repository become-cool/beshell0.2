

// 存储 pin 电平变化的 listener id
mapPinListeners = {} ;


function ConsoleWatchPin(pin, debounce) {
    if(mapPinListeners[pin]!=undefined) {
        try{
            clearWatch(mapPinListeners[pin])
        }catch(e) {}
    }
    mapPinListeners[pin] = setWatch(ConsoleOnPinChanged(pin), pin, {
        repeat: true, debounce: debounce==undefined?10: debounce, data: true
    })
}
function ConsoleUnwatchPin(pin) {
    try{ clearWatch(mapPinListeners[pin]) }catch(e){}
    try{ delete mapPinListeners[pin] }catch(e){}
}

function ConsoleOnPinChanged(pin) {
    return function(e) {
        console.log("\nrun<<EmitEvent('pin', '"+pin+"', "+(e.state?1:0)+")")
    }
}

global.ConsoleWatchPin = ConsoleWatchPin
global.ConsoleUnwatchPin = ConsoleUnwatchPin


global.be.console.watch = ConsoleWatchPin
global.be.console.unwatch = ConsoleWatchPin