const SensorBase = require("./sensorbase")

class Switch extends SensorBase {

    constructor(){
        super()
        this._listenid = -1
    }

    /**
     * 例子
     * 
     * 1. 监听 D30
     * switchN.begin(D30)
     * 
     * 2. 监听 D30，设置 D31 为低电平
     * switchN.begin(D30, D31)  
     */
    begin(pin1, pin2) {
        let watchPin
        if(pin1==undefined ){
            return
        }
        watchPin = pin1
        pinMode(pin1, "input_pullup")
        
        if(pin2!=undefined && pin2!=pin1){
            watchPin = pin1
            pinMode(pin2, "output", true)
            digitalWrite(pin2, 0)
        }
        
        if(this._listenid>-1) {
            clearWatch(this._listenid)
        }

        this._listenid = setWatch((event)=>{
            for(let hid in this._handles) {
                this._handles[hid](event)
            }
        }, watchPin, {repeat:true, edge: 'both', debounce: 25})
    }

    deinit() {
        if(this._listenid>-1) {
            clearWatch(this._listenid)
            this._listenid = -1
        }
        this.clearWatch()
    }
}


module.exports = Switch